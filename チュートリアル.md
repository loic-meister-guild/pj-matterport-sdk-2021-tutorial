# ãƒãƒ¼ã‚¿ãƒ¼ãƒãƒ¼ãƒˆSDKã®2021å¹´ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«
@ Matterport SDK 2021 Tutorial ([English](https://qiita.com/loic-meister-guild/items/8cf015969d9fbddc2160))

ã¾ãšã€Matterport ã‚¢ãƒ—ãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾ã™ï¼š

```
mkdir matterport-test
cd matterport-test
```
æ¬¡ã«ã€ç°¡å˜ãªWebã‚µãƒ¼ãƒãƒ¼ã‚’è¨­å®šã™ã‚‹ã“ã¨ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ã€€ï¼ï¼ï¼
## ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼
__Node.js__ã§__Express__ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨ã—ã¦ãƒšãƒ¼ã‚¸ã‚’æä¾›ã—ã¾ã™ã€‚
### Expressã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ã¾ãšã€ç©ºã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã€Œpackage.jsonã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆæœŸåŒ–ã—ã¾ã—ã‚‡ã†ï¼š

```
npm init -y
```
æ¬¡ã«ã€Express ã®æœ€æ–°ã®å®‰å®šç‰ˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ï¼š

```
npm install express
```
### ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã®ä½œæˆ
ã¾ãšã€ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ç”¨ã®JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ï¼š

```
touch server.js
```
æ¬¡ã«ã€ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã‚’è¨­å®šã—ã¾ã™ï¼š

```JavaScript:server.js
const express = require('express');
const app = express();
```
HTMLã€CSSã€JavaScriptã€ç”»åƒãªã©ã®é™çš„ã‚¢ã‚»ãƒƒãƒˆã‚’`public`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰æä¾›ã™ã‚‹ã‚ˆã†ã«__Express__ã‚’è¨­å®šã—ã¾ã™ï¼š

```JavaScript:server.js
const express = require('express');
const path = require('path');
const app = express();
app.use(express.static(path.join(__dirname, 'public')))
```
`public`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾ã™ï¼š

```
mkdir public
cd public
```
__Matterport__ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®HTMLã€CSSã€JavaScriptã‚’è¿½åŠ ã™ã‚‹ç©ºã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ï¼š

```
touch app.js
touch index.html
touch styles.css
cd ..
```
ã‚¢ãƒ—ãƒªã®HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’æä¾›ã™ã‚‹ãƒ«ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™ï¼š

```JavaScript:server.js
// ...
app.get('/', (req, res) => {
    res.sendFile(`${__dirname}/public/index.html`);
});
```
æœ€å¾Œã«ã€ãƒãƒ¼ãƒˆã€Œ8000ã€ã«ãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®šã—ã¦__Express__ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã—ã‚‡ã†ï¼š

```JavaScript:server.js
// ...
app.listen(8000, () => {
    console.log('Application listening on port 8000!');
});
```
### ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•
ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹ã«ã¯ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š

```
node server.js
```
ã“ã‚Œã§ã€Œ http://localhost:8000 ã€ã®ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã§ã‚¢ãƒ—ãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
## [Matterport SDK for Embeds](https://matterport.github.io/showcase-sdk/sdk_home.html)
__Matterport__ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã«ã¯ã€å®Ÿéš›ã«è£œå®Œçš„ãª[2ã¤ã®SDK](https://support.matterport.com/hc/en-us/articles/360061477754)ãŒãƒªã‚¹ãƒˆã•ã‚Œã¦ã„ã¾ã™ï¼š 

- [Matterport SDK for Embeds](https://matterport.github.io/showcase-sdk/sdk_home.html)ï¼šåŸºæœ¬çš„ãª__ãƒãƒ¼ã‚¿ãƒ¼ãƒãƒ¼ãƒˆã®3D Showcase SDK__ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ã‚¨ãƒ³ãƒ‰ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½ç½®ã¨__3Dã‚·ãƒ§ãƒ¼ã‚±ãƒ¼ã‚¹__ã§ã®è¡¨ç¤ºå†…å®¹ã‚’å¤‰æ›´ã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½ç½®ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¡¨ç¤ºã¾ãŸã¯å®Ÿè¡Œã—ã¦ã„ã‚‹ã“ã¨ã«é–¢ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒªãƒƒã‚¹ãƒ³ã—ã€é©åˆ‡ã«åå¿œã§ãã¾ã™ã€‚
- [Matterport SDK Bundle](https://matterport.github.io/showcase-sdk/sdk_home.html)ï¼šçµ„ã¿è¾¼ã¿ç”¨ã®__SDK for embeds__ã®æ‹¡å¼µã§ã€ãƒãƒ¼ã‚¿ãƒ¼ãƒãƒ¼ãƒˆãƒ»ãƒ¢ãƒ‡ãƒ«ã¨ã®ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã¨ã®ç·Šå¯†ãªçµ±åˆã¨ã€3Dã‚¨ãƒ³ã‚¸ãƒ³ã€ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã€ã‚·ãƒ¼ãƒ³ ã‚°ãƒ©ãƒ•ãªã©ã¸ã®ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã®ãŸã‚ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’æä¾›ã—ã¾ã™ã€‚

ç¬¬1ã®ã‚¢ãƒ—ãƒªã‚’ä½œæˆã™ã‚‹ã«ã¯ã€ï¼ˆç„¡æ–™ã®ï¼‰ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ãƒ»ã‚¢ã‚¯ã‚»ã‚¹ã§åŸ‹ã‚è¾¼ã¿ç”¨ã®__SDK for Embeds__ã‚’ä½¿ç”¨ã—ã¾ã™ã€€ï¼ï¼ï¼
### ç„¡æ–™åˆ©ç”¨æ 
ç„¡æ–™ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ ãƒ—ãƒ©ãƒ³ã§ã¯ã€ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ ãƒ¢ãƒ¼ãƒ‰ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã«åˆ¶é™ä»˜ãã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ï¼š

- SDKã®ã‚­ãƒ¼ã¯`localhost`ã§ã®ã¿ä½¿ç”¨ã§ãã¾ã™ã€‚ä»–ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã§ã¯ä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚
- APIã®ãƒˆãƒ¼ã‚¯ãƒ³ã¯ãƒ‡ãƒ¢ãƒ»ãƒ¢ãƒ‡ãƒ«ã«å¯¾ã—ã¦ã®ã¿ä½¿ç”¨ã§ãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½œæˆã—ãŸãƒ¢ãƒ‡ãƒ«ã«å¯¾ã—ã¦ã¯ä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚

ãã‚Œã§ã¯ã€ç¬¬1ã®ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚
### ç¬¬1ã®ã‚¢ãƒ—ãƒªï¼šåŸºç¤
ã¾ãšã€åŸºæœ¬çš„ãª__Matterport__ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€€ï¼ï¼ï¼
##### HTML
ã¾ãšã€ã‚¢ãƒ—ãƒªã®æœ€å°é™ã®ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ï¼š

```public/index.html
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0, shrink-to-fit=no">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
        <title>Matterport Test</title>
        <script src="/app.js" defer></script>
        <link rel="stylesheet" href="/styles.css">
    </head>
    <body>
    </body>
</html>
```
æ¬¡ã«ã€`<head>`ã‚¿ã‚°ã«Javascriptãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å«ã‚ã¦ã€__3D Showcase SDK__ã‚’Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«è¿½åŠ ã—ã¾ã™ï¼š

```public/index.html
<html lang="en">
    <head>
        ...
        <script src='https://static.matterport.com/showcase-sdk/2.0.1-0-g64e7e88/sdk.js'></script>
        <script src="/app.js" defer></script>
        <link rel="stylesheet" href="/styles.css">
    </head>
    ...
```
æœ€å¾Œã«ã€`<iframe>`ã‚¿ã‚°ã‚’è¿½åŠ ã—ã¦ã€ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã«ãƒãƒ¼ã‚¿ãƒ¼ãƒãƒ¼ãƒˆãƒ»ã‚¹ãƒšãƒ¼ã‚¹ã‚’åŸ‹ã‚è¾¼ã¿ã¾ã™ï¼š

```public/index.html
...
    <body>
        <iframe id="showcase" width="960" height="480" title="test" frameBorder="0" allowFullScreen allow="vr"></iframe>
    </body>
</html>
```
`<iframe>`ã®å±æ€§ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

- `frameBorder="0"`ï¼š`<iframe>`ã®å‘¨å›²ã«å¢ƒç•Œç·šãŒæç”»ã•ã‚Œãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚
- `allowFullScreen`ï¼š__ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒ¢ãƒ¼ãƒ‰__ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
- `allow="vr"`ï¼šã„ãã¤ã‹ã®ã‚³ãƒ¼ãƒ‰ãƒ»ã‚µãƒ³ãƒ—ãƒ«ã§è¦‹ã¤ã‹ã‚Šã¾ã—ãŸãŒã€ä½•ã‚‚ã—ã¦ã„ãªã„ã‚ˆã†ã§ã™ã€‚
- `allow="xr-spatial-tracking"`ï¼š[__xr immersive mode__](https://matterport.github.io/showcase-sdk/sdkbundle_tutorials_using_xr.html)ã‚’æœ‰åŠ¹ã«ã—ã¾ã™ï¼ˆSDK Bundleã ã‘ï¼‰ã€‚

##### JavaScript
æ¬¡ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®JavaScriptã‚³ãƒ¼ãƒ‰ã§ï¼š

- `DOMContentLoaded`ã®ã‚¤ãƒ™ãƒ³ãƒˆã¾ã§å¾…ã¡ã¾ã™ã€‚
- `<iframe>`ã®ãƒãƒ¼ã‚¿ãƒ¼ãƒãƒ¼ãƒˆãƒ»ã‚¹ãƒšãƒ¼ã‚¹ã®ã‚½ãƒ¼ã‚¹ã‚’è¨­å®šã—ã¾ã™ã€‚
- ãƒãƒ¼ã‚¿ãƒ¼ãƒãƒ¼ãƒˆãƒ»ã‚¹ãƒšãƒ¼ã‚¹ã‚’å«ã‚€`<iframe>`ãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹ã¾ã§å¾…ã¡ã¾ã™ã€‚
- SDKã‚’ãƒãƒ¼ã‚¿ãƒ¼ãƒãƒ¼ãƒˆãƒ»ã‚¹ãƒšãƒ¼ã‚¹ã«æ¥ç¶šã—ã¾ã™ã€‚

```public/app.js
"use strict";

const sdkKey = "aaaaXaaaXaaaXaaaaXaaaXaaa"
const modelSid = "SxQL3iGyoDo";
const params = `m=${modelSid}&hr=0&play=1&qs=1`;

var iframe = document.getElementById('showcase');

document.addEventListener("DOMContentLoaded", () => {
    iframe.setAttribute('src', `https://my.matterport.com/show/?${params}`);
    iframe.addEventListener('load', () => showcaseLoader(iframe));
});

function showcaseLoader(iframe){
    try{
        window.MP_SDK.connect(iframe, sdkKey, '3.10')
            .then(loadedShowcaseHandler)
            .catch(console.error);
    } catch(e){
        console.error(e);
    }
}

function loadedShowcaseHandler(mpSdk){
    // ...
}
```
`params`å†…ã®URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

- `applicationKey=aaaaXaaaXaaaXaaaaXaaaXaaa`ï¼š[ãƒãƒ¼ã‚¿ãƒ¼ãƒãƒ¼ãƒˆãƒ»ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ â†’ è¨­å®š â†’ é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã€SDKã®ã‚­ãƒ¼ç®¡ç†](https://my.matterport.com/settings/account/devtools)ã§å–å¾—ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®SDKã®ã‚­ãƒ¼ã€‚
- `hr=0`ï¼šç”»é¢ã®ä¸‹éƒ¨ã«__highlight reel__ã‚’è¡¨ç¤ºã™ã‚‹__open highlights__ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤ºã«ã—ã¾ã™ã€‚
- `log=0`ï¼šãƒ­ã‚®ãƒ³ã‚°ã‚’ç„¡åŠ¹ã«ã—ã¾ã™ï¼Ÿ
- `m=SxQL3iGyoDo`ï¼šè¡¨ç¤ºã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã®SIDã€‚
- `play=1`ï¼š1ã«è¨­å®šã™ã‚‹ã¨ã€ãƒšãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿æ™‚ã«`<iframe>`ãŒè‡ªå‹•çš„ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚
- `qs=1`ï¼šï¼Ÿ

### ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
3Dã‚·ãƒ§ãƒ¼ã‚±ãƒ¼ã‚¹ã§å®Ÿè¡Œã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®£è¨€ã™ã‚‹ã«ã¯ã€æ¬¡ã®ã‚ˆã†ã«å®£è¨€ã—ã¾ã™ï¼š

- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒæˆåŠŸã—ãŸå ´åˆã«ä½•ã‹ã‚’è¡Œã†ãŸã‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼š

```JavaScript
function successCallback(message) { console.log(message); }
```
- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå¤±æ•—ã—ãŸå ´åˆã«ä½•ã‹ã‚’è¡Œã†ãŸã‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼š

```JavaScript
function errorCallback(error) { console.error(error); }
```
- å¿…è¦ãªå¼•æ•°ã‚’æŒ‡å®šã—ã¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‘¼ã³å‡ºã—ã¾ã™ï¼š

```JavaScript
mpSdk.<moduleName>.<actionName>(<actionArguments>).then(successCallback)
.catch(errorCallback);
```
__ã‚¢ã‚¯ã‚·ãƒ§ãƒ³__ã¯å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®[ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://matterport.github.io/showcase-sdk/sdk_reference_summary)ã®__é–¢æ•°__ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ãƒªã‚¹ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚
##### ä¾‹ï¼šãƒ¢ãƒ‡ãƒ«ã¸ã®Mattertagã®è¿½åŠ 
ãƒ©ãƒ™ãƒ«ã€èª¬æ˜ã€ã‚¹ãƒ†ãƒ ã€ãŠã‚ˆã³ç”»åƒã‚’ä½¿ç”¨ã—ã¦[Mattertagã‚’ä½œæˆã™ã‚‹](https://matterport.github.io/showcase-sdk/sdk_creating_mattertags.html)ã«ã¯ã€æ¬¡ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å®£è¨€ã—ã¾ã™ï¼š

```JavaScript
var myMattertag = {
    label: 'A Tool',
    description: 'A cute little vacuum cleaner!',
    media: {
        type: mpSdk.Mattertag.MediaType.PHOTO,
        src: 'https://media.4rgos.it/i/Argos/8086071_R_Z001A',
    },
    anchorPosition: { x: -3.156, y: 0.363, z: 3.082 },
    stemVector: { x: -0.822, y: -0.041, z: 0.568 }
};
```
âš ï¸ ç”»åƒã‚„å‹•ç”»ã®ãƒ¡ãƒ‡ã‚£ã‚¢ ã‚½ãƒ¼ã‚¹ã¨ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ« URL ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ï¼
â€» [`Mattertag`](https://matterport.github.io/showcase-sdk/docs/sdk/reference/current/modules/mattertag.html)ã®ã‚¢ãƒ³ã‚«ãƒ¼ä½ç½®ã€stemVectorã€floorId ã‚’è¦‹ã¤ã‘ã‚‹ã«ã¯ã€[Mattertagã‚’ä½œæˆã™ã‚‹](https://matterport.github.io/showcase-sdk/sdk_creating_mattertags.html)ã§ã¯[Intersection Inspector Tool](https://matterport.github.io/showcase-sdk/sdk_intersection_inspector)ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ãŒã€[__Transient Tags Editor__](https://matterport.github.io/showcase-sdk/sdk_transient_tags_editor.html)ã®æ–¹ãŒã¯ã‚‹ã‹ã«å„ªã‚ŒãŸä½¿ã„ã‚„ã™ã„ãƒ„ãƒ¼ãƒ«ã§ã™ï¼
â€» ç”»åƒã¾ãŸã¯ãƒ“ãƒ‡ã‚ª ãƒ¡ãƒ‡ã‚£ã‚¢ã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ã€__Matterport__ã¯[embed.ly](https://embed.ly)ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ãƒ¡ãƒ‡ã‚£ã‚¢ ã‚½ãƒ¼ã‚¹ã¨ã—ã¦è¨­å®šã™ã‚‹å‰ã«ã€[embedly exploreã®è¡¨ç¤ºãƒ„ãƒ¼ãƒ«](https://embed.ly/docs/explore/display/resize)ã§ç”»åƒã¾ãŸã¯ãƒ“ãƒ‡ã‚ªã® URL ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚

æ¬¡ã«ã€[`Mattertag`](https://matterport.github.io/showcase-sdk/docs/sdk/reference/current/modules/mattertag.html)ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‹ã‚‰[`add`](https://matterport.github.io/showcase-sdk/docs/sdk/reference/current/modules/mattertag.html#add)é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¾ã™ï¼›

```JavaScript
mpSdk.Mattertag.add(myMattertag)
    .then(function(mattertagId) {
        console.log(mattertagId);
        // ...
    })
    .catch(function(error) {
        console.error(error);
        // ...
    });
```
### ã‚¤ãƒ™ãƒ³ãƒˆ
3Dã‚·ãƒ§ãƒ¼ã‚±ãƒ¼ã‚¹ã‹ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒªãƒƒã‚¹ãƒ³ã™ã‚‹ã«ã¯ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«[`on`](https://matterport.github.io/showcase-sdk/docs/sdk/reference/current/index.html#on)é–¢æ•°ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```JavaScript
showcase.on(<eventName>, function (<stateArguments>) {
    // what to do when this event happens
});
```
â€» 3Dã‚·ãƒ§ãƒ¼ã‚±ãƒ¼ã‚¹ã‹ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒªãƒƒã‚¹ãƒ³ã‚’åœæ­¢ã™ã‚‹ã«ã¯ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«[`off`](https://matterport.github.io/showcase-sdk/docs/sdk/reference/current/index.html#off)é–¢æ•°ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

__ã‚¤ãƒ™ãƒ³ãƒˆ__ã¯å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®[ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://matterport.github.io/showcase-sdk/sdk_reference_summary)ã®__åˆ—æŒ™__ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ãƒªã‚¹ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚
##### ä¾‹ï¼šMattertagã§ã®clickã‚¤ãƒ™ãƒ³ãƒˆã®æ¤œå‡º
[`mpSdk.Mattertag.Event.CLICK`](https://matterport.github.io/showcase-sdk/docs/sdk/reference/current/enums/mattertag.event.html#click)å¼•æ•°ã‚’æŒ‡å®šã—ã¦ã‚°ãƒ­ãƒ¼ãƒãƒ«[`on`](https://matterport.github.io/showcase-sdk/docs/sdk/reference/current/index.html#on)é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã€ã‚¤ãƒ™ãƒ³ãƒˆ ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®å¼•æ•°ã‚’ç¢ºèªã—ã¾ã™ï¼š

```JavaScript
mpSdk.on(mpSdk.Mattertag.Event.CLICK,
    function (tagSid) {
        console.log('Mattertag ' + tagSid + ' was selected');
    }
);
```
## ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€__ãƒãƒ¼ã‚¿ãƒ¼ãƒãƒ¼ãƒˆSDK__ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–æ€§ã‚’å¼·åŒ–ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚
### iframeã§clickã‚¤ãƒ™ãƒ³ãƒˆã®å‚å—
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ`<iframe>`ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ç¾åœ¨ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§`blur`ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹ __ãƒ•ã‚©ã‚«ã‚¹__ ãŒå–å¾—ã•ã‚Œã¾ã™ã€‚

âš ï¸ æœ€åˆã®`click`ã‚¤ãƒ™ãƒ³ãƒˆã®å¾Œã€ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’`window`ã«æˆ»ã™å¿…è¦ãŒã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ãã†ã—ãªã„ã¨ã€2ç•ªç›®ã®`click`ã‚¤ãƒ™ãƒ³ãƒˆãŒ`blur`ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ãªã„ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ï¼

âš ï¸ å·¦ã‚¯ãƒªãƒƒã‚¯ã€ä¸­ã‚¯ãƒªãƒƒã‚¯ã€å³ã‚¯ãƒªãƒƒã‚¯ã®åŒºåˆ¥ãŒã¤ãã¾ã›ã‚“ï¼

æ¬¡ã«ã€ã‚¯ãƒªãƒƒã‚¯ãŒãƒãƒ¼ã‚¿ãƒ¼ã‚ªãƒ¼ãƒˆã®`<iframe>`å†…ã§ç™ºç”Ÿã—ãŸã“ã¨ã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€€ï¼ï¼ï¼
##### æ–¹æ³•1ï¼šmouseoverã®ã‚¤ãƒ™ãƒ³ãƒˆ
`click`ã‚¤ãƒ™ãƒ³ãƒˆãŒãƒãƒƒã‚¿ãƒ¼ãƒãƒ¼ãƒˆã®`<iframe>`ã§ç™ºç”Ÿã—ãŸã‹ã©ã†ã‹ã‚’çŸ¥ã‚‹ã«ã¯ã€ãã‚Œã‚’`container`ã«åŸ‹ã‚è¾¼ã¿ã¾ã™ï¼š

```HTML
    ...
    <body>
        <div id="container">
            <iframe id="showcase" ...></iframe>
        </div>
    </body>
</html>
```
ãã—ã¦ã€`mouseover`ã‚¤ãƒ™ãƒ³ãƒˆã¨`mouseout`ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒªãƒƒã‚¹ãƒ³ã—ã¦ã€çŠ¶æ…‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå†…ã®ãƒã‚¦ã‚¹ ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã®ä½ç½®ã‚’è¿½è·¡ã—ã¾ã™ï¼š

```JavaScript
var stateObject = {
    isMouseOverIframe : false
}
window.addEventListener('blur',function(){
    if(stateObject.isMouseOverIframe){
        console.log('Yes! The click happened inside the iframe!');
        window.focus()
    }
});
document.getElementById('container').addEventListener('mouseover',function(){
    stateObject.isMouseOverIframe = true;
});
document.getElementById('container').addEventListener('mouseout',function(){
    stateObject.isMouseOverIframe = false;
});
```
âš ï¸ 
ãƒ¢ãƒã‚¤ãƒ«ã®å ´åˆã€`touchstart`ã‚„`touchend`ãªã©ã®[ã‚¿ãƒƒãƒãƒ»ã‚¤ãƒ™ãƒ³ãƒˆ](https://developer.mozilla.org/en-US/docs/Web/API/Touch_events)ã‚’å‡¦ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
##### æ–¹æ³•2ï¼šdocument.activeElement
ãƒãƒ¼ã‚¿ãƒ¼ãƒãƒ¼ãƒˆã®`<iframe>`ã§`click`ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ãŸã‹ã©ã†ã‹ã‚’çŸ¥ã‚‹ã«ã¯`document.activeElement`ãŒ`iframe`å¤‰æ•°ã«ã‚ˆã£ã¦å‚ç…§ã•ã‚Œã‚‹è¦ç´ ã¨åŒã˜ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ï¼š

```JavaScript
window.addEventListener('blur',function(){	
    window.setTimeout(function () {	
        if (document.activeElement === iframe) {
            console.log('Yes! The click happened inside the iframe!');
            window.focus()
        }
    }, 0);
});
```
â€» __Firefox__ã§æ©Ÿèƒ½ã•ã›ã‚‹ã«ã¯ã€0ç§’ã®`setTimeout`ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
### ãƒ¢ãƒ‡ãƒ«ã«ãƒãƒƒã‚¿ãƒ¼ã‚¿ã‚°ã‚’è¦–è¦šçš„ã«æŒ¿å…¥
__JSFiddle__ã§å…¬çš„ã«ãƒ›ã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹[Intersection Inspector](https://matterport.github.io/showcase-sdk/sdk_intersection_inspector.html)ã®[ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰](http://jsfiddle.net/guillermo_matterport/pftnhkuc)ã¨ã¯ç•°ãªã‚Šã€[Transient Tags Editor](https://matterport.github.io/showcase-sdk/sdk_transient_tags_editor.html)ã®[ã‚¢ãƒ—ãƒª](https://rmauldin.github.io/matterport/transient-tag-editor/app/)ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯__github__ã§éå…¬é–‹ã§ãƒ›ã‚¹ãƒˆã•ã‚Œã¦ã„ã¾ã™ï¼ˆFirefoxã§ã¯å®Œå…¨ã«å‹•ä½œã—ãªã„ãŸã‚ï¼Ÿï¼‰ã€‚

ã—ã‹ã—ã€[Transient Tags Editor](https://matterport.github.io/showcase-sdk/sdk_transient_tags_editor.html)ã®ä½¿ã„ã‚„ã™ã•ã«èˆˆå‘³ã‚’ããã‚‰ã‚Œã€ãƒãƒ¼ã‚¿ãƒ¼ãƒãƒ¼ãƒˆSDKãŒæä¾›ã™ã‚‹2ã¤ã®ãƒ„ãƒ¼ãƒ«ã®é•ã„ã‚’ç†è§£ã—ã¦ã€ãƒãƒ¼ã‚¿ãƒ¼ã‚¿ã‚°åº§æ¨™ã‚’è¦‹ã¤ã‘ãŸã„ã¨æ€ã„ã¾ã—ãŸã€‚
##### Intersection Inspector ã®ä»•çµ„ã¿
[Intersection Inspector](https://matterport.github.io/showcase-sdk/sdk_intersection_inspector.html)ã¯ã€__ã‚¿ã‚¤ãƒãƒ¼__ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ 1 ç§’ä»¥ä¸Š[`Pointer`](https://matterport.github.io/showcase-sdk/docs/sdkbundle/reference/current/modules/camera.html)ã‚’å‹•ã‹ã•ãªã„ã¨ã€ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã®ä½ç½®ã«ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦__Mattertag__åº§æ¨™ã‚’è¡¨ç¤ºã—ã€æ‰‹å‹•ã§ã‚³ãƒ”ãƒ¼ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€€ï¼ï¼ï¼

ã“ã‚Œã‚’å®Ÿç¾ã™ã‚‹ã«ã¯ã€ã‚«ãƒ¡ãƒ©ã®[`pose`](https://matterport.github.io/showcase-sdk/docs/sdkbundle/reference/current/modules/camera.html#pose-1)ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¦³å¯Ÿã—ã¦å–å¾—ã™ã‚‹ç¾åœ¨ã®[`Camera`](https://matterport.github.io/showcase-sdk/docs/sdkbundle/reference/current/modules/camera.html)ä½ç½®ãŒå¿…è¦ã§ã™ï¼š

```JavaScript
    var poseCache;
    mpSdk.Camera.pose.subscribe(function(pose) {
        poseCache = pose;
    });
```
ã¾ãŸã€ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã®[`intersection`](https://matterport.github.io/showcase-sdk/docs/sdkbundle/reference/current/modules/pointer.html#intersection-1)äº¤å·®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¦³å¯Ÿã—ã¦å–å¾—ã™ã‚‹ç¾åœ¨ã®[`Pointer`](https://matterport.github.io/showcase-sdk/docs/sdkbundle/reference/current/modules/camera.html)ä½ç½®ã‚‚å¿…è¦ã§ã™ï¼š


```JavaScript
    var intersectionCache;
    mpSdk.Pointer.intersection.subscribe(function(intersection) {
        intersectionCache = intersection;
        intersectionCache.time = new Date().getTime();
        button.style.display = 'none';
        buttonDisplayed = false;
    });
```
â€» ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒã‚¤ãƒ³ã‚¿ãƒ¼ã‚’ç§»å‹•ã™ã‚‹ã¨`intersection`ã‚¤ãƒ™ãƒ³ãƒˆãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹ãŸã‚ã€1 ç§’ã®é…å»¶ãŒçµŒéã™ã‚‹å‰ã«ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œãªã„ã‚ˆã†ã«ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤ºã«ã—ã¾ã™ã€‚

æ¬¡ã«ã€[`setInterval()`](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setInterval)ã‚’ä½¿ç”¨ã—ã¦__ã‚¿ã‚¤ãƒãƒ¼__ã‚’è¨­å®šã—ã€é©åˆ‡ãªæ™‚é–“ã«ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã—ã¾ã™ï¼š

```JavaScript
    setInterval(() => {
        // ...
    }, 16);
```

ã‚¿ã‚¤ãƒãƒ¼ ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ã¯ã€ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ã™ã¹ã¦ã®æ¡ä»¶ãŒæº€ãŸã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã¾ã™ã€€ï¼ï¼ï¼

- ã¾ãšã€å¿…è¦ãªæƒ…å ±ãŒã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ï¼š

```JavaScript
    setInterval(() => {
        if (!intersectionCache || !poseCache) {
            return;
        }
        // ...
    }, 16);
```
- æ¬¡ã«ã€æœ€å¾Œã®`intersection`ã‚¤ãƒ™ãƒ³ãƒˆãŒå—ä¿¡ã•ã‚Œã¦ã‹ã‚‰1ç§’ãŒçµŒéã—ãŸã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ã‹ã€æ¬¡ã®ãƒ†ã‚£ãƒƒã‚¯ã‚’å¾…ã£ã¦å†åº¦ç¢ºèªã—ã¾ã™ï¼›

```JavaScript
    var delayBeforeShow = 1000;
    setInterval(() => {
        if (!intersectionCache || !poseCache) {
            return;
        }
        const nextShow = intersectionCache.time + delayBeforeShow;
        if (new Date().getTime() > nextShow) {
            // ...
        }
    }, 16);
```
- æœ€å¾Œã«ã€ãƒœã‚¿ãƒ³ãŒã¾ã è¡¨ç¤ºã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ï¼š

```JavaScript
    var delayBeforeShow = 1000;
    var buttonDisplayed = false;
    setInterval(() => {
        if (!intersectionCache || !poseCache) {
            return;
        }
        const nextShow = intersectionCache.time + delayBeforeShow;
        if (new Date().getTime() > nextShow) {
            if (buttonDisplayed) {
                return;
            }
            // ...
        }
    }, 16);
```
æ¡ä»¶ãŒæº€ãŸã•ã‚ŒãŸã‚‰ã€[`Conversion.worldToScreen()`](https://matterport.github.io/showcase-sdk/docs/sdkbundle/reference/current/modules/conversion.html#worldtoscreen)ã‚’ä½¿ç”¨ã—ã¦ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã—ã€ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã®ç”»é¢åº§æ¨™ã‚’å–å¾—ã§ãã¾ã™ï¼š

```JavaScript
    // ...
    setInterval(() => {
        // ...
        if (new Date().getTime() > nextShow) {
            // ...
            var size = {
                w: iframe.clientWidth,
                h: iframe.clientHeight,
            };
            var coord = mpSdk.Conversion.worldToScreen(intersectionCache.position, poseCache, size);
            button.style.left = `${coord.x - 25}px`;
            button.style.top = `${coord.y - 22}px`;
            button.style.display = 'block';
            buttonDisplayed = true;
        }
    }, 16);
```
ã“ã®ãƒœã‚¿ãƒ³ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯`display: none;`ã‚’ä½¿ç”¨ã—ã¦éè¡¨ç¤ºã«ã•ã‚Œã€`position: absolute;`ã‚’ä½¿ç”¨ã—ã¦æœ¬æ–‡ã«å¯¾ã—ã¦ç›¸å¯¾çš„ã«é…ç½®ã•ã‚Œã‚‹å˜ç´”ãª HTML ãƒœã‚¿ãƒ³ã§ã™ã€‚

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ãƒã‚¤ãƒ³ã‚¿ã®ç¾åœ¨ã®åº§æ¨™ãŒ`<iframe>`ã®ä¸Šã®`<div>`ã‚¿ã‚°ã«è¡¨ç¤ºã•ã‚Œã€ãƒœã‚¿ãƒ³ãŒéè¡¨ç¤ºã«ãªã‚Šã¾ã™ï¼š

```JavaScript
    button.addEventListener('click', function() {
        text.innerHTML = `position: ${pointToString(intersectionCache.position)}\nnormal: ${pointToString(intersectionCache.normal)}\nfloorId: ${intersectionCache.floorId}`;
        button.style.display = 'none';
        iframe.focus();
    });
```
åº§æ¨™ã¯ã€æ¬¡ã®é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã¾ã™ï¼š

```JavaScript
function pointToString(point) {
  var x = point.x.toFixed(3);
  var y = point.y.toFixed(3);
  var z = point.z.toFixed(3);

  return `{ x: ${x}, y: ${y}, z: ${z} }`;
}
```
ã§ã¯ã€ã‚ˆã‚Šä½¿ã„ã‚„ã™ãã€ä½¿ã„ã‚„ã™ã„[Transient Tags Editor](https://matterport.github.io/showcase-sdk/sdk_transient_tags_editor.html)ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ãŒã©ã®ã‚ˆã†ã«æ©Ÿèƒ½ã™ã‚‹ã‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€€ï¼ï¼ï¼
##### Transient Tag Editor ã®ä»•çµ„ã¿
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã„ãã¤ã‹ã®ãƒ¢ãƒ‡ãƒ«ã«æ°¸ç¶šçš„ã«è¨­å®šã™ã‚‹__ãƒãƒƒã‚¿ãƒ¼ã‚¿ã‚°__ãŒã„ãã¤ã‹ã‚ã‚‹å ´åˆã¯ã€[Intersection Inspector](https://matterport.github.io/showcase-sdk/sdk_intersection_inspector.html)ã§ååˆ†ã§ã™ã€‚ãŸã ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ¢ãƒ‡ãƒ«ã«ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã«ã‚¿ã‚°ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã¯ã€[Transient Tags Editor](https://matterport.github.io/showcase-sdk/sdk_transient_tags_editor.html)ã®GUIã®ã‚ˆã†ãªã‚‚ã®ãŒé–‹å§‹ç‚¹ã¨ã—ã¦é©ã—ã¦ã„ã¾ã™ã€‚

[Transient Tags Editor](https://matterport.github.io/showcase-sdk/sdk_transient_tags_editor.html)ã‚’ä½¿ç”¨ã™ã‚‹ä¸»ãªåˆ©ç‚¹ã¯ã€`Mattertag`ãŒã©ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‹ã‚’ä½œæˆå‰ã«ç¢ºèªã§ãã‚‹ã“ã¨ã§ã™ã€‚ã“ã†ã™ã‚‹ã“ã¨ã§ã€è©¦è¡ŒéŒ¯èª¤ã™ã‚‹ã“ã¨ãªãæ­£ç¢ºã«ã‚¿ã‚°ã‚’é…ç½®ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€€ï¼ï¼ï¼

ã‚¿ã‚°ã‚’è¿½åŠ ã™ã‚‹ã«ã¯ã€ã€Œæ–°ã—ã„ã‚¿ã‚°ã‚’é…ç½®ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€Œã‚¿ã‚°ã®è¿½åŠ ã€ãƒ¢ãƒ¼ãƒ‰ã«å…¥ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã®å¾Œã€å¿…è¦ãªå ´æ‰€ã«æ–°ã—ã„ã‚¿ã‚°ã‚’1ã¤é…ç½®ã§ãã¾ã™ã€‚

ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã®ãã®å´é¢ã«ã®ã¿ç„¦ç‚¹ã‚’å½“ã¦ã€ã‚¿ã‚°ã‚’è¿½åŠ ã™ã‚‹ã ã‘ã®ç°¡å˜ãªã‚µãƒ³ãƒ—ãƒ«ã‚’ä½œæˆã—ã¾ã™ï¼š

- ã€Œã‚¿ã‚°ã®è¿½åŠ ã€ãƒ¢ãƒ¼ãƒ‰ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒã‚¤ãƒ³ã‚¿ãƒ¼ã«æ²¿ã£ã¦ã‚¿ã‚°ã‚’ç§»å‹•ã™ã‚‹ã¨ã€æœ€åˆã®ã‚¹ãƒ†ãƒƒãƒ—ã¯æ–°ã—ã„ã‚¿ã‚°ã‚’ä½œæˆã—ã¦é…ç½®ã™ã‚‹ã“ã¨ã§ã™ã€‚[`Mattertag.add()`](https://matterport.github.io/showcase-sdk/docs/sdkbundle/reference/current/modules/mattertag.html#add)ã‚’ä½¿ç”¨ã—ã¦ã€ãã®ãŸã‚ã®é–¢æ•°ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ï¼š

```JavaScript
    function addTag() {
        if(!tag){
            mpSdk.Mattertag.add([{
                label: "Matterport Tag",
                description: "",
                anchorPosition: {x: 0, y: 0, z: 0},
                stemVector: {x:0, y: 0, z: 0},
                color: {r: 1, g: 0, b: 0},
            }])
            .then((sid) => {
                tag = sid[0];
            })
            .catch( (e) => {
                console.error(e);
            })
        }
    }
```
- æ¬¡ã«ã€ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã®è¿‘ãã«ã‚¿ã‚°ã‚’é…ç½®ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒã‚¤ãƒ³ã‚¿ãƒ¼ã‚’ç§»å‹•ã™ã‚‹ã¨ãã®ä½ç½®ã‚’æ›´æ–°ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€[`Mattertag.editPosition()`](https://matterport.github.io/showcase-sdk/docs/sdkbundle/reference/current/modules/mattertag.html#editposition)ã‚’ä½¿ç”¨ã—ã¦ãã®ãŸã‚ã®é–¢æ•°ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ï¼š

```JavaScript
    function updateTagPos(newPos, newNorm=undefined, scale=undefined){
        if(!newPos) return;
        if(!scale) scale = .33;
        if(!newNorm) newNorm = {x: 0, y: 1, z: 0};

        mpSdk.Mattertag.editPosition(tag, {
            anchorPosition: newPos,
            stemVector: {
                x: scale * newNorm.x,
                y: scale * newNorm.y,
                z: scale * newNorm.z,
            }
        })
        .catch(e =>{
            console.error(e);
            tag = null;
        });
    }
```
ã”è¦§ã®ã¨ãŠã‚Š`updateTagPos()`é–¢æ•°ã¯ 3 ã¤ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’å—ã‘å–ã‚Šã¾ã™ï¼š

1. __newPos__ï¼š`Mattertag`ã®æ–°ã—ã„ã‚¢ãƒ³ã‚«ãƒ¼ä½ç½®ã€‚
2. __newNorm__ï¼š`Mattertag`ã®æ–°ã—ã„ã‚¹ãƒ†ãƒ ãƒ»ãƒ™ã‚¯ãƒˆãƒ«ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€‚
3. __scale__ï¼š`Mattertag`ã®ã‚¹ãƒ†ãƒ ç”¨ã®æ–°ã—ã„ã‚¹ã‚±ãƒ¼ãƒ«ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€‚

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒã‚¤ãƒ³ã‚¿ãƒ¼ã‚’ç§»å‹•ã—ãŸã¨ãã«ã‚¿ã‚°ã®ä½ç½®ã‚’æ›´æ–°ã™ã‚‹ã«ã¯ã€ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã®[`intersection`](https://matterport.github.io/showcase-sdk/docs/sdkbundle/reference/current/modules/pointer.html#intersection-1)äº¤å·®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¦³å¯Ÿã—ã¦`updateTagPos()`ã‚’å‘¼ã³å‡ºã—ã¾ã™ï¼š

```JavaScript
    mpSdk.Pointer.intersection.subscribe(intersectionData => {
        if(tag){
            if(intersectionData.object === 'intersectedobject.model' || intersectionData.object === 'intersectedobject.sweep'){
                updateTagPos(intersectionData.position, intersectionData.normal);
            }
        }
    });
```
- æ–°ã—ã„ã‚¿ã‚°ã‚’é…ç½®ã™ã‚‹ã«ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒã‚¦ã‚¹ ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã ã‘ã§ã™ã€‚[Transient Tags Editor](https://matterport.github.io/showcase-sdk/sdk_transient_tags_editor.html)ã¯ã€`<iframe>`ã§ã®ã‚¯ãƒªãƒƒã‚¯ã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã™ã‚‹ç‹¬è‡ªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®`document.activeElement`æ–¹æ³•ã‚’æä¾›ã—ã¾ã™_ï¼ˆãŸã ã—ã€__Firefox__ã§ã¯æ©Ÿèƒ½ã—ãªã„ãŸã‚ã€ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã¯éå¸¸ã«è¤‡é›‘ãªå›é¿ç­–ï¼‰_ï¼š

```JavaScript
    function focusDetect(){
        const eventListener = window.addEventListener('blur', function() {
            if (document.activeElement === iframe) {
                placeTag(); //function you want to call on click
                setTimeout(function(){ window.focus(); }, 0);
            }
            window.removeEventListener('blur', eventListener );
        });
    }
```
ãŸã ã—ã€__Firefox__ã§ã‚ˆã‚Šé©åˆ‡ã«å‹•ä½œã™ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¾ã™ _ï¼ˆãŸã ã—ã€ä½•ã‚‰ã‹ã®ç†ç”±ã§__Firefox__ã§æœ€åˆã«ã‚¯ãƒªãƒƒã‚¯ã—ãŸå¾Œã¯å‹•ä½œã‚’åœæ­¢ã—ã¾ã™ï¼‰_ï¼š

```JavaScript
    window.addEventListener('blur',function(){  
        window.setTimeout(function () { 
            if (document.activeElement === iframe) {
                placeTag(); //function you want to call on click
                window.focus()
                addTag();
            }
        }, 0);
    });
```
- æœ€å¾Œã«ã€[`Mattertag.navigateToTag()`](https://matterport.github.io/showcase-sdk/docs/sdkbundle/reference/current/modules/mattertag.html#navigatetotag)ã‚’ä½¿ç”¨ã—ã¦ã€æ–°ã—ã„ã‚¿ã‚°ã«ç§»å‹•ã—ã¦ãã®__billboardï¼ˆçœ‹æ¿ï¼‰ã‚’é–‹ã__é–¢æ•°ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ï¼š

```JavaScript
    function placeTag(){
        if(tag) mpSdk.Mattertag.navigateToTag(tag, mpSdk.Mattertag.Transition.INSTANT);
        tag = null;
    }
```

##### å˜ç´”ãªã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã®ã‚µãƒ³ãƒ—ãƒ«
ã¾ãšã€å…¨ã¦ã®JavaScriptã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ï¼š

```JavaScript
"use strict";

const sdkKey = "nsai8wcy6qwb4wfzh6k1u2mgc"
const modelSid = "iL4RdJqi2yK";

let iframe;
let tag;

document.addEventListener("DOMContentLoaded", () => {
    iframe = document.querySelector('.showcase');
    iframe.setAttribute('src', `https://my.matterport.com/show/?m=${modelSid}&help=0&play=1&qs=1&gt=0&hr=0`);
    iframe.addEventListener('load', () => showcaseLoader(iframe));
});

function showcaseLoader(iframe){
    try{
        window.MP_SDK.connect(iframe, sdkKey, '3.10')
        .then(loadedShowcaseHandler)
        .catch(console.error);
    } catch(e){
        console.error(e);
    }
}

function loadedShowcaseHandler(mpSdk){
    addTag()

    function placeTag(){
        if(tag) mpSdk.Mattertag.navigateToTag(tag, mpSdk.Mattertag.Transition.INSTANT);
        tag = null;
    }

    window.addEventListener('blur',function(){  
        window.setTimeout(function () { 
            if (document.activeElement === iframe) {
                placeTag(); //function you want to call on click
                window.focus()
                addTag();
            }
        }, 0);
    });
    function updateTagPos(newPos, newNorm=undefined, scale=undefined){
        if(!newPos) return;
        if(!scale) scale = .33;
        if(!newNorm) newNorm = {x: 0, y: 1, z: 0};

        mpSdk.Mattertag.editPosition(tag, {
            anchorPosition: newPos,
            stemVector: {
                x: scale * newNorm.x,
                y: scale * newNorm.y,
                z: scale * newNorm.z,
            }
        })
        .catch(e =>{
            console.error(e);
            tag = null;
        });
    }

    mpSdk.Pointer.intersection.subscribe(intersectionData => {
        if(tag){
            if(intersectionData.object === 'intersectedobject.model' || intersectionData.object === 'intersectedobject.sweep'){
                updateTagPos(intersectionData.position, intersectionData.normal);
            }
        }
    });

    function addTag() {
        if(!tag){
            mpSdk.Mattertag.add([{
                label: "Matterport Tag",
                description: "",
                anchorPosition: {x: 0, y: 0, z: 0},
                stemVector: {x:0, y: 0, z: 0},
                color: {r: 1, g: 0, b: 0},
            }])
            .then((sid) => {
                tag = sid[0];
            })
            .catch( (e) => {
                console.error(e);
            })
        }
    }
} // loadedShowcaseHandler
```
HTMLã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ï¼š

```HTML
<!DOCTYPE html>
<html>
    <head>
        <title>Transient Tag Editor</title>
        <style>
            #showcase {
                width: 100%;
                height: 100vh;
            }
        </style>
        <script src="https://static.matterport.com/showcase-sdk/2.0.1-0-g64e7e88/sdk.js"></script>
        <script src="/js/app-editor.js" type="text/javascript" defer></script>
    </head>
    <body>
        <iframe id="showcase" frameborder="0"  allowFullScreen allow="xr-spatial-tracking"></iframe>
    </body>
</html>
```
ã‚„ã£ãŸï¼
## [Matterport SDK Bundle](https://matterport.github.io/showcase-sdk/sdkbundle_home.html)
ç¬¬2ã®ã‚¢ãƒ—ãƒªã‚’ä½œæˆã™ã‚‹ãŸã‚ã«ã€ä»Šå›ã¯__SDK Bundle__ã‚’ä½¿ç”¨ã—ã¾ã™ãŒã€ã¾ã ï¼ˆç„¡æ–™ã®ï¼‰ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ãƒ»ã‚¢ã‚¯ã‚»ã‚¹ã§ã™ã€€ï¼ï¼

ã¾ãšã€æœ€æ–°ã®[SDK Bundleã®ãƒ‘ã‚±ãƒ¼ã‚¸](https://static.matterport.com/showcase-sdk/bundle/3.1.41.5-19-g5133fdd3e/showcase-bundle.zip)ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

æ¬¡ã«ã€ç¬¬2ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®2ã¤ç›®ã®ãƒ«ãƒ¼ãƒˆã‚’å‡¦ç†ã™ã‚‹ã‚ˆã†ã«ã‚µãƒ¼ãƒãƒ¼ã‚’æ›´æ–°ã—ã¾ã—ã‚‡ã†ã€€ï¼ï¼ï¼
### ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼
ãƒãƒ³ãƒ‰ãƒ« ã‚¢ãƒ—ãƒªã®ãƒ«ãƒ¼ãƒˆã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ï¼š

```JavaScript:server.js
// ...
app.get('/bundle', (req, res) => {
    res.sendFile(`${__dirname}/public/index-bundle.html`);
});
app.listen(8000, () => {
    console.log('Application listening on port 8000!');
});
```
ãã®å¾Œã€ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•ã—ã¦ã€€ï¼ï¼ï¼
### ç¬¬2ã®ã‚¢ãƒ—ãƒªï¼šåŸºç¤
æœ€åˆã®ã‚‚ã®ã¨ä¼¼ã¦ã„ã‚‹ã®ã§ã€åˆ¥ã®åŸºæœ¬çš„ãª__Matterport__ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚æœ€åˆã®ã‚¢ãƒ—ãƒª ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦åå‰ã‚’å¤‰æ›´ã§ãã¾ã™ã€€ï¼ï¼ï¼
##### HTML
ã¾ãšã€`index.html`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€`index-bundle.html`ã«åå‰ã‚’å¤‰æ›´ã—ã¾ã™ï¼š

JavaScriptã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’`app-bundle.js`ã«å¤‰æ›´ã—ã¾ã™ï¼š

```public/index-bundle.html
...
        <script src="/app-bundle.js" defer></script>
...
```
##### JavaScript
ãã‚Œã§ã¯ã€`app.js`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€`app-bundle.js`ã«åå‰ã‚’å¤‰æ›´ã—ã¾ã—ã‚‡ã†ã€‚

ãã“ã§ã€iframeã®sourceURLã‚’`/bundle/showcase.html?${params}`ã«å¤‰æ›´ã—ã¾ã™ï¼š

```public/app-bundle.js
// ...
document.addEventListener("DOMContentLoaded", () => {
    iframe.setAttribute('src', `/bundle/showcase.html?${params}`);
    iframe.addEventListener('load', () => showcaseLoader(iframe));
});
// ...
```
ãã—ã¦ã€`connect`ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚’æ¬¡ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™`iframe.contentWindow.MP_SDK.connect`ï¼š

```public/app-bundle.js
// ...
function showcaseLoader(iframe){
    try{
        iframe.contentWindow.MP_SDK.connect(iframe, sdkKey, '3.10')
            .then(loadedShowcaseHandler)
            .catch(console.error);
    } catch(e){
        console.error(e);
    }
}
// ...
```
### ã‚·ãƒ¼ãƒ³
__SDK Bundle__ã¯ã€æ¨™æº–ã®SDKã«è¿½åŠ ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã‚ã‚‹`Scene`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’æä¾›ã—ã¾ã™ã€‚
##### ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°
ã‚·ãƒ¼ãƒ³ã«ã¯ãƒ©ã‚¤ãƒˆãŒå¿…è¦ã§ã™ã€‚ãƒ©ã‚¤ãƒˆãŒãªã„å ´åˆã€ãƒ¢ãƒ‡ãƒ«ã¯é»’ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

__Matterport__ã¯ã€ã“ã®ãŸã‚ã«`mp.lights`ã¨å‘¼ã°ã‚Œã‚‹åŸºæœ¬çš„ãªãƒ©ã‚¤ãƒˆ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æä¾›ã—ã¾ã™ã€‚[`Scene.createNode()`](https://matterport.github.io/showcase-sdk/docs/sdkbundle/reference/current/modules/scene.html#createnode)ã‚’ä½¿ç”¨ã—ã¦ã‚·ãƒ¼ãƒ³ã«ãƒãƒ¼ãƒ‰ã‚’ä½œæˆã—ã€[`INode.addComponent()`](https://matterport.github.io/showcase-sdk/docs/sdkbundle/reference/current/interfaces/scene.inode.html#addcomponent)ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãã‚Œã«ã‚¢ã‚¿ãƒƒãƒã—ã¾ã—ã‚‡ã†ï¼š

```JavaScript:loadedShowcaseHandler(mpSdk)
    const lights = await mpSdk.Scene.createNode();
    lights.addComponent('mp.lights');
    lights.start();
```
â€» 
ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ [`INode.start()`](https://matterport.github.io/showcase-sdk/docs/sdkbundle/reference/current/interfaces/scene.inode.html#start)ã‚’å‘¼ã³å‡ºã—ã¦ã€å‹•ä½œã‚’é–‹å§‹ã—ã¾ã™ã€‚
### ãƒ¢ãƒ‡ãƒ«
__SDK Bundle__ã¯ã€æ¬¡ã®ã‚·ãƒ¼ãƒ³ãŠã‚ˆã³ãƒ¢ãƒ‡ãƒ« ã‚¢ã‚»ãƒƒãƒˆ ã‚¿ã‚¤ãƒ—ã®ãƒ­ãƒ¼ãƒ‰ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ï¼š

- __dae__ã€`mpSdk.Scene.Component.DAE_LOADER`ã§
- __fbx__ã€`mpSdk.Scene.Component.FBX_LOADER `ã§
- __obj__ã€`mpSdk.Scene.Component.OBJ_LOADER `ã§
- __gltf__ã€`mpSdk.Scene.Component.GLTF_LOADER `ã§

ãƒ¢ãƒ‡ãƒ«ã¯ã€ç…§æ˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚ˆã†ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦ã‚·ãƒ¼ãƒ³ã«è¿½åŠ ã•ã‚Œã¾ã™ï¼š

```JavaScript:loadedShowcaseHandler(mpSdk)
    // ...
    const modelNode = await mpSdk.Scene.createNode();
    const fbxComponent = modelNode.addComponent(mpSdk.Scene.Component.DAE_LOADER, {
        url: 'https://gitcdn.link/repo/mrdoob/three.js/dev/examples/models/collada/stormtrooper/stormtrooper.dae',
    });
```
â€» __SDK Bundle__ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«[__Working With Models__](https://matterport.github.io/showcase-sdk/sdkbundle_tutorials_models.html#select-a-model)ï¼ˆãƒ¢ãƒ‡ãƒ«ã®æ“ä½œï¼‰ã«ã„ãã¤ã‹ã®ãƒ¢ãƒ‡ãƒ«ãŒãƒªã‚¹ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚
##### æ‹¡å¤§ç¸®å°
ä¸€éƒ¨ã®ãƒ¢ãƒ‡ãƒ«ã¯å®Ÿä¸–ç•Œã®å˜ä½ã«èª¿æ•´ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€ãƒ¢ãƒ‡ãƒ«ã‚’ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã—ã¦ã‚ˆã‚Šç¾å®Ÿçš„ãªã‚µã‚¤ã‚ºã«èª¿æ•´ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼š

```JavaScript:loadedShowcaseHandler(mpSdk)
    // ...
    fbxComponent.inputs.localScale = {
        x: 0.3,
        y: 0.3,
        z: 0.3
    };
```
##### ãƒã‚¸ã‚·ãƒ§ãƒ‹ãƒ³ã‚°ã€æŒ‰æ’
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ä½ç½®ã¯(0, 0, 0)ã§ã™ãŒã€ã‚¹ãƒˆãƒ¼ãƒ ãƒˆãƒ«ãƒ¼ãƒ‘ãƒ¼ã‚’ç©ºä¸­ã«æµ®ã‹ã›ãŸããªã„å ´åˆã¯ã€ãã‚Œã‚’ä¸‹ã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

```JavaScript:loadedShowcaseHandler(mpSdk)
    // ...
    modelNode.obj3D.position.set(0,-1.65,0);
```
##### å›è»¢
ã‚¹ãƒˆãƒ¼ãƒ ãƒˆãƒ«ãƒ¼ãƒ‘ãƒ¼ã®ãƒ¢ãƒ‡ãƒ«ã¯ã€yè»¸ã«æ²¿ã£ãŸè§’åº¦ãŒ0ã®å ´åˆã¯ã‚«ãƒ¡ãƒ©ã®æ–¹ã‚’å‘ãã€è§’åº¦ãŒ`ğœ‹`ã®å ´åˆã¯ã‚«ãƒ¡ãƒ©ã®æ–¹ã‚’å‘ãã¾ã™ï¼š

```JavaScript:loadedShowcaseHandler(mpSdk)
    // ...
    modelNode.obj3D.rotation.y = Math.PI
```
â€» __Matterport__ã¯ã€__Three.js__ã®ã‚ˆã†ã«ã€è§’åº¦ã‚’æŒ‡å®šã™ã‚‹ãŸã‚ã«ãƒ©ã‚¸ã‚¢ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã—ãŸã€‚

##### ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆ
ç…§æ˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨åŒæ§˜ã«ã€[`INode.start()`](https://matterport.github.io/showcase-sdk/docs/sdkbundle/reference/current/interfaces/scene.inode.html#start)ã‚’ä½¿ç”¨ã—ã¦ãƒ¢ãƒ‡ãƒ«ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

```JavaScript:loadedShowcaseHandler(mpSdk)
    // ...
    modelNode.start();
```
### ç¬¬2ã®ã‚¢ãƒ—ãƒª: ã¾ã¨ã‚
2ç•ªç›®ã®ã‚¢ãƒ—ãƒªã‚’å®Œæˆã•ã›ã¾ã—ã‚‡ã†ã€€ï¼ï¼ï¼
##### 
ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
ãƒ¢ãƒ‡ãƒ«ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŒ–ã™ã‚‹ã«ã¯ã€å˜ã«[`requestAnimationFrame()`](https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame)é–¢æ•°ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

ã‚¹ãƒˆãƒ¼ãƒ ãƒˆãƒ«ãƒ¼ãƒ‘ãƒ¼ã‚’å‰å¾Œã«å‹•ã‹ã—ãªãŒã‚‰ã‚†ã£ãã‚Šå›è»¢ã•ã›ã¾ã—ã‚‡ã†ï¼š

```JavaScript:loadedShowcaseHandler(mpSdk)
    // ...
    let step = -0.1
    let zPos = 0
    const tick = function() {
        requestAnimationFrame(tick);
        if (zPos>= 1.8) {
            step = -0.02
        } else if (zPos <= -0.4) {
            step = 0.02
        }
        zPos += step
        modelNode.obj3D.rotation.y += 0.02;
        modelNode.obj3D.position.set(0,-1.65,zPos);
    }
    tick();
```
##### JavaScriptã‚³ãƒ¼ãƒ‰ã®ã¾ã¨ã‚
ã™ã¹ã¦ã‚’`app-bundle.js`ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¾ã¨ã‚ã¾ã—ã‚‡ã†ï¼š

```JavaScript:app-bundle.js
"use strict";

const sdkKey = "aaaaXaaaXaaaXaaaaXaaaXaaa"
const modelSid = "22Ub5eknCVx";
const params = `m=${modelSid}&play=1&qs=1&log=0&applicationKey=${sdkKey}`;

var iframe = document.getElementById('showcase');

document.addEventListener("DOMContentLoaded", () => {
    iframe.setAttribute('src', `/bundle/showcase.html?${params}`);
    iframe.addEventListener('load', () => showcaseLoader(iframe));
});

function showcaseLoader(iframe){
    try{
        iframe.contentWindow.MP_SDK.connect(iframe, sdkKey, '3.10')
        .then(loadedShowcaseHandler)
        .catch(console.error);
    } catch(e){
        console.error(e);
    }
}

async function loadedShowcaseHandler(mpSdk){
  const lights = await mpSdk.Scene.createNode();
  lights.addComponent('mp.lights');
  lights.start();

  const modelNode = await mpSdk.Scene.createNode();
  const fbxComponent = modelNode.addComponent(mpSdk.Scene.Component.DAE_LOADER, {
    url: 'https://gitcdn.link/repo/mrdoob/three.js/dev/examples/models/collada/stormtrooper/stormtrooper.dae',
  });

  fbxComponent.inputs.localScale = {
    x: 0.3,
    y: 0.3,
    z: 0.3
  };

  modelNode.obj3D.position.set(0,-1.65,0);

  modelNode.obj3D.rotation.y = Math.PI

  modelNode.start();

  let step = -0.1
  let zPos = 0
  const tick = function() {
    requestAnimationFrame(tick);
    if (zPos>= 1.8) {
      step = -0.02
    } else if (zPos <= -0.4) {
      step = 0.02
    }
    zPos += step
    modelNode.obj3D.rotation.y += 0.02;
    modelNode.obj3D.position.set(0,-1.65,zPos);
  }
  tick();
}
```
## [Matterport Model API](https://support.matterport.com/hc/en-us/articles/360041976053)
ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§æ¤œè¨ã—ãŸ 2 ã¤ã® SDK ã«åŠ ãˆã¦ã€__Matterport__ã¯__API Token__ã‚’ä½¿ç”¨ã™ã‚‹[__Model API__ã¨å‘¼ã°ã‚Œã‚‹__GraphQL API__](https://support.matterport.com/hc/en-us/articles/360041976053)ã‚‚æä¾›ã—ã¾ã™ã€‚SDKã¨ã®é•ã„ã¯[__FAQ__](https://support.matterport.com/hc/en-us/articles/360041976053#faqs-0-5)ã§èª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

ç®¡ç†è€…æ¨©é™ã§Matterport Cloudï¼ˆmy.matterport.comï¼‰ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å®šçš„ã«__GraphQL API__ã‚’è©¦ã™ã“ã¨ãŒã§ãã‚‹__ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ»ã‚³ãƒ³ã‚½ãƒ¼ãƒ«__ãŒ[__reference documentation__](https://api.matterport.com/docs/reference)ã¨ã¨ã‚‚ã«åˆ©ç”¨ã§ãã¾ã™ã€‚
## å…¨ã¦ã®ã‚³ãƒ¼ãƒ‰
ã™ã¹ã¦ã®ã‚µãƒ³ãƒ—ãƒ«ã®ã‚³ãƒ¼ãƒ‰ã¯ã€__github__ã§å…¥æ‰‹ã§ãã¾ã™ï¼š
[github.com/loic-meister-guild/pj-matterport-sdk-2021-tutorial](https://github.com/loic-meister-guild/pj-matterport-sdk-2021-tutorial)
## å‚ç…§
- [Node.js + Express Tutorial for 2021](https://catalins.tech/nodejs-express-tutorial-for-2021-getting-started-with-the-javascript-web-server-framework)
- [How to detect a click event on a cross domain iframe](https://gist.github.com/jaydson/1780598)
